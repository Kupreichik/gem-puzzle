(()=>{"use strict";function t(t,e){this.size=4,this.startState=this.setStartState(),this.state=JSON.parse(JSON.stringify(this.startState)),this.movingNum,this.movingCell,this.color="#00e2bb",this.context=t,this.cellSize=Math.round(e/this.size),this.moves=0,this.time=0,this.timeRuns=!0,this.sound=!0,this.isEnable=!0}function e(){if(0===Math.floor(2*Math.random()))return!0}t.prototype.getNullCell=function(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(0===this.state[e][t])return{x:t,y:e}},t.prototype.moveCell=function(t,e){let i=this.getNullCell(),s=(t-1==i.x||t+1==i.x)&&e==i.y,n=(e-1==i.y||e+1==i.y)&&t==i.x;(s||n)&&(this.state[i.y][i.x]=this.state[e][t],this.state[e][t]=0)},t.prototype.shuffleCells=function(t){let i,s;for(let n=0;n<t;n++){let t=this.getNullCell(),n=e(),o=e();n?(i=t.x,s=o?t.y-1:t.y+1):(s=t.y,i=o?t.x-1:t.x+1),0<=i&&i<=this.size-1&&0<=s&&s<=this.size-1&&this.moveCell(i,s)}this.clicks=0},t.prototype.cellView=function(t,e){this.context.fillStyle=this.color,this.context.fillRect(t+1,e+1,this.cellSize-2,this.cellSize-2)},t.prototype.numView=function(){this.context.font="bold "+Math.round(this.cellSize/2)+"px Sans",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillStyle="#222"},t.prototype.gameDraw=function(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)this.state[t][e]>0&&(this.cellView(e*this.cellSize,t*this.cellSize),this.numView(),this.context.fillText(this.state[t][e],e*this.cellSize+Math.round(this.cellSize/2),t*this.cellSize+Math.round(this.cellSize/2)))};const i=document.querySelector(".root");t.prototype.setMovingCell=function(t){let e=(t.pageX-g.offsetLeft)/this.cellSize|0,i=(t.pageY-g.offsetTop)/this.cellSize|0;this.movingCell={x:e,y:i},this.movingNum=this.state[i][e],this.state[i][e]=null,this.positionX=this.movingCell.x*this.cellSize,this.positionY=this.movingCell.y*this.cellSize,this.mouseDownAt={x:t.pageX,y:t.pageY}},t.prototype.movingCellDraw=function(t){let e="mousemove"==t.type?t.clientX:t.touches[0].clientX,i="mousemove"==t.type?t.clientY:t.touches[0].clientY;M.context.clearRect(0,0,g.width,g.height),M.context.fillRect(0,0,g.width,g.height),M.gameDraw(),M.context.fillRect(e-g.offsetLeft-Math.round(M.cellSize/2),i-g.offsetTop-Math.round(M.cellSize/2),M.cellSize,M.cellSize),M.cellView(e-g.offsetLeft-Math.round(M.cellSize/2),i-g.offsetTop-Math.round(M.cellSize/2)),M.numView(),M.context.fillText(M.movingNum,e-g.offsetLeft,i-g.offsetTop)},t.prototype.victory=function(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(this.startState[t][e]!=this.state[t][e])return!1;return!0};const s={3:[],4:[],5:[],6:[],7:[],8:[],setResults(t){this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8]}};function n(t){this.sound=document.createElement("audio"),this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.style.display="none",i.appendChild(this.sound),this.play=function(){this.sound.play()},this.soundOn='<svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M16 8.99999C16.5 9.49999 17 10.5 17 12C17 13.5 16.5 14.5 16 15M19 6C20.5 7.5 21 10 21 12C21 14 20.5 16.5 19 18M13 3L7 8H5C3.89543 8 3 8.89543 3 10V14C3 15.1046 3.89543 16 5 16H7L13 21V3Z" stroke="#001A72" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',this.soundOff='<svg width="28px" height="28px" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M3.28033 2.21967C2.98744 1.92678 2.51257 1.92677 2.21967 2.21967C1.92678 2.51256 1.92677 2.98743 2.21967 3.28033L7.94442 9.00518H5.25C3.45508 9.00518 2 10.4602 2 12.2552V15.7472C2 17.5421 3.45507 18.9972 5.25 18.9972H8.26174C8.70619 18.9972 9.134 19.1663 9.45832 19.4702L14.3953 24.0963C15.1937 24.8445 16.5 24.2783 16.5 23.1842V17.5609L24.7194 25.7805C25.0123 26.0734 25.4872 26.0734 25.7801 25.7805C26.073 25.4876 26.073 25.0127 25.7801 24.7198L3.28033 2.21967ZM15 16.0609V22.6073L10.484 18.3756C9.88165 17.8112 9.08715 17.4972 8.26174 17.4972H5.25C4.2835 17.4972 3.5 16.7137 3.5 15.7472V12.2552C3.5 11.2887 4.2835 10.5052 5.25 10.5052H8.26119C8.61056 10.5052 8.95438 10.4489 9.28044 10.3412L15 16.0609Z" fill="#212121"/>\n<path d="M10.6222 7.44026L11.6834 8.50147L15 5.3913V11.8182L16.5 13.3182V4.81413C16.5 3.71975 15.1932 3.15373 14.395 3.90233L10.6222 7.44026Z" fill="#212121"/>\n<path d="M20.1724 16.9907L21.3088 18.1271C21.9119 16.8787 22.25 15.4782 22.25 13.9998C22.25 11.8635 21.544 9.88995 20.3528 8.30269C20.1042 7.97139 19.6341 7.90437 19.3028 8.15299C18.9715 8.40161 18.9045 8.87173 19.1531 9.20303C20.1561 10.5395 20.75 12.1992 20.75 13.9998C20.75 15.0577 20.545 16.067 20.1724 16.9907Z" fill="#212121"/>\n<path d="M22.975 19.7933L24.0705 20.8888C25.2945 18.8814 26 16.5225 26 13.9999C26 10.6481 24.7545 7.58532 22.7021 5.2521C22.4285 4.94109 21.9546 4.91074 21.6436 5.18432C21.3326 5.4579 21.3022 5.9318 21.5758 6.24281C23.3966 8.31273 24.5 11.0265 24.5 13.9999C24.5 16.1069 23.9459 18.0837 22.975 19.7933Z" fill="#212121"/>\n</svg>\n'}function o(){localStorage.removeItem("game"),M.context.clearRect(0,0,g.width,g.height),M.context.fillRect(0,0,g.width,g.height),M.context.font="24px sans-serif",M.context.textAlign="center",M.context.textBaseline="middle",M.context.fillStyle="#00e2bb";let t=M.time%60,e=Math.floor(M.time/60),i=`in ${e<10?"0"+e:e}:${t<10?"0"+t:t} and ${M.moves} moves!`;M.context.fillText("Hooray!",Math.round(g.width/2),Math.round(g.height/2)-50),M.context.fillText("You solved the puzzle",Math.round(g.width/2),Math.round(g.height/2)),M.context.fillText(i,Math.round(g.width/2),Math.round(g.height/2)+50),M.timeRuns=!1,M.sound&&new n("./sounds/zvuk-fanfar.mp3").play(),function(){let t={};t.time=M.time,t.moves=M.moves,s[M.size].push(t),s[M.size].sort(((t,e)=>t.time>e.time?1:-1)),s[M.size].length>10&&s[M.size].pop()}()}function l(){try{let t=M.movingCell.x,e=M.movingCell.y,i=M.getNullCell(),s=i.x,n=i.y,o=s-t,a=n-e;M.context.clearRect(0,0,g.width,g.height),M.context.fillRect(0,0,g.width,g.height),M.gameDraw(),M.cellView(M.positionX,M.positionY),M.numView(),M.context.fillText(M.movingNum,M.positionX+Math.round(M.cellSize/2),M.positionY+Math.round(M.cellSize/2)),M.positionX=M.positionX+2*o,M.positionY=M.positionY+2*a,Math.round(M.positionX/2)+1*o!==Math.round(s*M.cellSize/2)||Math.round(M.positionY/2)+1*a!==Math.round(n*M.cellSize/2)?setTimeout(l,1):M.finishMove()}catch{console.log("Ошибка обработана")}}function a(t){g.removeEventListener("mousemove",M.movingCellDraw),g.removeEventListener("mouseup",a),Math.abs(M.mouseDownAt.x-t.pageX)<3&&Math.abs(M.mouseDownAt.y-t.pageY)<3?l():M.finishMove()}function c(t){if(!M.timeRuns)return!1;if(!M.isEnable)return!1;{let e=(t.pageX-g.offsetLeft)/M.cellSize|0,i=(t.pageY-g.offsetTop)/M.cellSize|0;M.canMove(e,i)&&(M.isEnable=!1,M.setMovingCell(t),g.addEventListener("mousemove",M.movingCellDraw),g.addEventListener("mouseup",a))}}function r(t){g.removeEventListener("touchmove",M.movingCellDraw),g.removeEventListener("touchend",r),Math.abs(M.mouseDownAt.x-t.changedTouches[0].pageX)<3&&Math.abs(M.mouseDownAt.y-t.changedTouches[0].pageY)<3?l():M.finishMove()}function h(t){if(!M.timeRuns)return!1;if(!M.isEnable)return!1;{let e=(t.touches[0].pageX-g.offsetLeft)/M.cellSize|0,i=(t.touches[0].pageY-g.offsetTop)/M.cellSize|0;M.canMove(e,i)&&(M.isEnable=!1,M.setMovingCell(t.touches[0]),g.addEventListener("touchmove",M.movingCellDraw),g.addEventListener("touchend",r)),t.preventDefault()}}function d(){let t=M.time%60,e=Math.floor(M.time/60),i=t<10?"0"+t:t,s=e<10?"0"+e:e;C.textContent=`Time: ${s}:${i}`,M.time=M.timeRuns?M.time+1:M.time,setTimeout(d,1e3)}function u(t){t.target.classList.contains("size")&&(M.size=+t.target.getAttribute("id"),[...document.querySelectorAll(".size")].forEach((t=>t.classList.remove("current-size"))),t.target.classList.add("current-size"),M.newGame())}function m(t){let e=[...document.querySelectorAll(".res-row")];for(let i=0;i<10;i++)if(s[t][i]){let n=s[t][i].time%60,o=Math.floor(s[t][i].time/60),l=n<10?"0"+n:n,a=o<10?"0"+o:o;e[i].innerHTML=`<span class="row">${i+1}</span>\n      <span class="row">${a}:${l}</span>\n      <span class="row">${s[t][i].moves}</span>`}else e[i].innerHTML=""}function v(t){t.target.classList.contains("res-size")&&([...document.querySelectorAll(".res-size")].forEach((t=>t.classList.remove("current-size"))),t.target.classList.add("current-size"),m(+t.target.textContent[0]))}function f(t){if(t.target.classList.contains("new-game")&&(M.newGame(),localStorage.removeItem("game")),t.target.closest(".sound-btn")&&(M.sound=!M.sound,w.innerHTML=M.sound?y.soundOn:y.soundOff),t.target.classList.contains("save")&&localStorage.setItem("game",JSON.stringify(M)),t.target.classList.contains("results"))if(document.querySelector(".res-container")){let t=document.querySelector(".res-container");t.classList.remove("res-container-active"),setTimeout((()=>{t.remove()}),400)}else!function(){let t=document.createElement("div");t.classList.add("res-container"),z.append(t);let e=document.createElement("div");e.classList.add("container"),e.innerHTML='<div class="res-size">3x3</div>\n                  <div class="res-size">4x4</div>\n                  <div class="res-size">5x5</div>\n                  <div class="res-size">6x6</div>\n                  <div class="res-size">7x7</div>\n                  <div class="res-size">8x8</div>',t.prepend(e);let i=document.createElement("div");i.classList.add("container","res-headings"),i.innerHTML='<div class="res-heading">RATING</div>\n  <div class="res-heading">TIME</div>\n  <div class="res-heading">MOVES</div>',e.after(i);for(let t=0;t<10;t++){let t=document.createElement("div");t.classList.add("container","res-row"),i.after(t)}[...e.querySelectorAll(".res-size")].forEach((t=>{t.textContent[0]==M.size&&t.classList.add("current-size")})),m(M.size),e.addEventListener("click",v),setTimeout((()=>{t.classList.add("res-container-active")}),1),document.addEventListener("click",(t=>{let e=document.querySelector(".res-container");!e||t.target.closest(".res-container")||t.target.classList.contains("results")||(e.classList.remove("res-container-active"),setTimeout((()=>{e.remove()}),400))}))}()}t.prototype.finishMove=function(){let t=this.getNullCell();this.state[t.y][t.x]=this.movingNum,this.state[this.movingCell.y][this.movingCell.x]=0,this.moves++,this.movingNum=null,this.movingCell=null,this.context.clearRect(0,0,g.width,g.height),this.context.fillRect(0,0,g.width,g.height),this.gameDraw(),this.positionX=0,this.positionY=0,this.mouseDownAt=0,this.isEnable=!0,L.textContent=`Moves: ${this.moves}`,this.sound&&y.play(),this.victory()&&setTimeout(o,500)},t.prototype.canMove=function(t,e){let i=this.getNullCell(),s=(t-1==i.x||t+1==i.x)&&e==i.y,n=(e-1==i.y||e+1==i.y)&&t==i.x;return!(!s&&!n)},t.prototype.setStartState=function(){let t=[],e=1;for(let i=0;i<this.size;i++){let s=[];for(let t=0;t<this.size;t++)s.push(e),e++;t[i]=s}return t[t.length-1][t.length-1]=0,t},t.prototype.newGame=function(){this.moves=0,this.time=1,C.textContent="Time: 00:00",L.textContent=`Moves: ${this.moves}`,this.startState=this.setStartState(),this.state=JSON.parse(JSON.stringify(this.startState));let t=this.size>5?1e3:500;this.shuffleCells(t),this.cellSize=Math.round(g.width/this.size),this.context.clearRect(0,0,g.width,g.height),this.context.fillStyle="#222",this.context.fillRect(0,0,g.width,g.height),this.gameDraw(),this.timeRuns=!0};let g=document.createElement("canvas");g.width=320,g.height=320;let p=g.getContext("2d");p.fillRect(0,0,g.width,g.height);let x=document.createElement("div");x.classList.add("container"),x.innerHTML='<div class="size" id="3">3x3</div>\n                  <div class="size" id="4">4x4</div>\n                  <div class="size" id="5">5x5</div>\n                  <div class="size" id="6">6x6</div>\n                  <div class="size" id="7">7x7</div>\n                  <div class="size" id="8">8x8</div>';let z=document.createElement("div");z.classList.add("container"),z.innerHTML='<div class="btn new-game">New Game</div>\n<div class="btn save">Save</div>\n<div class="btn results">Best Results</div>';let w=document.createElement("div");w.classList.add("btn","sound-btn");let S=document.createElement("div");S.classList.add("container");let C=document.createElement("div");C.classList.add("time");let L=document.createElement("div");L.classList.add("moves"),L.textContent="Moves: 0";let M=new t(p,g.width),y=new n("./sounds/chpok.mp3");window.onload=function(){if(localStorage.getItem("game")){let t=JSON.parse(localStorage.getItem("game"));M.size=t.size,M.cellSize=Math.round(g.width/M.size),M.startState=t.startState,M.state=t.state,M.moves=t.moves,M.time=t.time,M.sound=t.sound}else M.shuffleCells(600);M.gameDraw(),i.append(g),g.before(z),g.after(x),z.after(S),z.append(w),S.prepend(C),S.append(L),L.textContent=`Moves: ${M.moves}`,w.innerHTML=M.sound?y.soundOn:y.soundOff,d(),[...document.querySelectorAll(".size")].forEach((t=>{t.textContent[0]==M.size&&t.classList.add("current-size")})),g.addEventListener("mousedown",c),g.addEventListener("touchstart",h),x.addEventListener("click",u),z.addEventListener("click",f),localStorage.getItem("results-p")&&s.setResults(JSON.parse(localStorage.getItem("results-p")))},window.addEventListener("beforeunload",(function(){let t=JSON.stringify(s);localStorage.setItem("results-p",t)}))})();